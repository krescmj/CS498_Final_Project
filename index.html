<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Sticky Footer Navbar Template for Bootstrap</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous">
    <!-- <link href="css/starter-template.css" rel="stylesheet"> -->
    <!-- <link href="css/styles.css" rel="stylesheet"> -->

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="./css/ie10-viewport-bug-workaround.css" rel="stylesheet">  -->

    <!-- Custom styles for this template -->
    <link href="./css/sticky-footer-navbar.css" rel="stylesheet">
	
	<style>

	body {
	  font: 12px sans-serif;
	}

	.axis path,
	.axis line {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}

	.dot {
	  stroke: #000;
	}
	
	div.tooltip {	
    position: absolute;			
    text-align: center;								
    padding: 2px;				
    font: 16px sans-serif;		
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}

	</style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">MLB Payroll Investment Payback</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="#about">Wins</a></li>
            <li><a href="#contact">World Series Wins</a></li>
			<li><a href="#contact">Explore</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <!-- Begin page content -->
    <div class="container" id="data_viz">
      <div class="page-header">
        <h1><center>MLB Baseball Team Payroll Versus Wins<center></h1>
      </div>
	  
	  <div>
		<svg id="legend_svg">
		</svg>
	  </div>
	  
	  <div>
		<svg id="data_viz_svg">
		</svg>
	  </div>
	  
	  <p class="lead">2006 - 2016 Data (mlb.com)</p>

    </div>

    <footer class="footer">
      <div class="container">
        <p class="text-muted"><center>Author: Michael Kresca</center></p>
      </div>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
          integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
          crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  
  		<script>
			var radius = 6;
		
			var margin = {top: 20, right: 20, bottom: 60, left: 40},
				height = parseInt(window.getComputedStyle(document.getElementById("data_viz")).height) - margin.top - margin.bottom,
				width =  parseInt(window.getComputedStyle(document.getElementById("data_viz")).width)  - margin.left - margin.right;
			
		    var x_scale = d3.scale.linear().range([radius+2, width-radius-2]),
				x_axis = d3.svg.axis().scale(x_scale).orient("bottom").ticks(5),
			    y_scale = d3.scale.linear().range([height-radius-2, radius+2]),
				y_axis = d3.svg.axis().scale(y_scale).orient("left");
				
			var svg = d3.select("#data_viz_svg")
			            .attr("height", height + margin.top + margin.bottom)
			            .attr("width", width + margin.left + margin.right)
						.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
						
			var legend_svg = d3.select("#legend_svg")
			                   .attr("width", width + margin.left + margin.right)
							   .attr("height", 20)
							   .append("g").attr("transform", "translate(" + margin.left + ",0)");

			var tooltip = d3.select("body").append("div")
						    .attr("class", "tooltip")
						    .style("opacity", 0);
							
			var voronoi = d3.geom.voronoi()
	                        .x(function(d) { return x_scale(d.payroll); })
	                        .y(function(d) { return y_scale(d.wins); })
	                        .clipExtent([[0, 0], [width, height]]);
							
			var color = d3.scale.category10();
			
			var legend_width = 30;
			var legend_height = 15;
			var legend_spacing = 3;
			
			var transition_duration = 500;
		
			d3.csv('./data/payroll.csv',
				function(error, dataset)
				{
					console.log(error);
				
					// cast to an integer
					dataset.forEach(function(d) {
						d.payroll = +d.payroll;
						d.year = +d.year;
						d.wins = +d.wins;
					});
					
					x_scale.domain([ d3.min(dataset, function (d) { return d.payroll; }), 
							         d3.max(dataset, function (d) { return d.payroll; })]);	

					y_scale.domain([ d3.min(dataset, function (d) { return d.wins; }), 
								     d3.max(dataset, function (d) { return d.wins; })]);
					
					svg.append("g")
					     .attr("class", "x axis")
						 .style("font", "14px times")
					     .attr("transform", "translate(0," + height + ")")
						 .call(x_axis)
						 .append("text")
						 .attr("class", "label")
						 .style("text-anchor", "middle")
						 .attr("x", width/2)
						 .attr("y", 30)
						 .text("Payroll (dollars)");

					svg.append("g")
					     .attr("class", "y axis")
						 .style("font", "14px times")
						 .call(y_axis)
						 .append("text")
						 .attr("class", "label")
						 .attr("transform", "rotate(-90)")
                         .attr("y", -30)
					     .style("text-anchor", "middle")
						 .attr("x", -height/2)
						 .text("Wins (number)");
								
			        svg.selectAll('circle')
					   .data(dataset)
					   .enter()
					   .append('circle')
					   .attr('r', function(d) { return radius; })
					   .attr('cx', function(d) { return x_scale(d.payroll); })
					   .attr('cy', function(d) { return y_scale(d.wins); })
					   .attr('id','viz_circle')
					   .attr('team_name', function(d) { return d.team; })
					   .style("fill", function(d) { return color(d.year); });
					   
					var legend = legend_svg.append("g")
										   .selectAll("g")
										   .data(color.domain())
										   .enter()
										   .append('g')
										   .attr('class', 'legend')
										   .attr('transform', function(d, i)
															  {
																 var x = i * legend_width * 2 + 7;
																 return 'translate(' + x + ', 0)';
															  });  
	
	legend.append('rect')
    .attr('width', legend_width)
    .attr('height', legend_height)
    .style('fill', color)
    .style('stroke', color);

legend.append('text')
    .attr('x', legend_width + legend_spacing)
    .attr('y', legend_height - legend_spacing)
    .text(function(d) { return d; });
					   
						  
					svg.selectAll("path")
					   .data(voronoi(dataset)) //Use vononoi() with your dataset inside
					   .enter()
					   .append("path")
	                   .attr("d", function(d, i) { return "M" + d.join("L") + "Z"; })
	                   .datum(function(d, i) { return d.point; })
					   .style("stroke-opacity", 0.5)
	                   .style("fill", "none")
	                   .style("pointer-events", "all")
					   .on("mouseover", function(d) {	
					   
							tooltip.transition()
								   .duration(transition_duration)
							       .style("opacity", .9);
				            
							tooltip.html( "<b> <center> Team Name: </b>"+ d.team + "</center>" )
                                   .style("left", (d3.event.pageX + 5) + "px")
                                   .style("top", (d3.event.pageY - 28) + "px");
							
							var coords = d3.mouse(this);
								
							svg.selectAll("#tooltip_line")
							   .data(dataset)
							   .enter()
							   .append('line')
							   .filter(function(line_d){ return line_d.team.valueOf() == d.team.valueOf();})
							   .attr('x1', (coords[0] + 15) + "px")
							   .attr('x2', function(d) { return x_scale(d.payroll); })
							   .attr('y1', (coords[1] - 5) + "px")
							   .attr('y2', function(d) { return y_scale(d.wins); })
							   .attr('id', 'tooltip_line')
							   .attr('stroke', 'gray')
							   .attr('stroke-width', "1")
							   .transition()
							   .duration(transition_duration);
							   .style("opacity", 0.9);
							   
							   d3.selectAll("#viz_circle")
							     .each( function(circle_d, i) {
                                     if( circle_d.team.valueOf() == d.team.valueOf() ) 
									 {
											d3.select(this).attr("r", radius*1.5);
											d3.select(this).attr("opacity", null)
									 }
									 else
									 {
										d3.select(this).attr("opacity", 0.2);
										d3.select(this).attr("r", radius);
									 }
								 })
								 .transition()
							     .duration(transition_duration);;
						})		 
					   .on("mousemove", function(d) {
							var coords = d3.mouse(this);
							
							tooltip.html( "<b> Team Name: </b>"+ d.team )
                                   .style("left", (d3.event.pageX + 5) + "px")
                                   .style("top", (d3.event.pageY - 28) + "px");
							
							svg.selectAll("#tooltip_line")
							   .attr('x1', (coords[0] + 5) + "px")
							   .attr('y1', (coords[1] - 28) + "px")

					   })
					   .on("mouseout", function(d) {
					   
                            tooltip.transition()
                                   .duration(transition_duration)
                                   .style("opacity", 0);
								   
						    svg.selectAll("#tooltip_line")
							   .transition()
							   .duration(transition_duration)
                               .remove();
							   
							d3.selectAll("#viz_circle")
							  .each( function(circle_d, i) {
									d3.select(this).attr("r", radius);
									d3.select(this).attr("opacity", null);
							  })
							  .transition()
							  .duration(transition_duration);
							   
                       })		
				}	
			);
		</script>
  
  </body>
</html>
